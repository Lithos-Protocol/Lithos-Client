<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorial-basics/lfsm-core" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">LFSM Core | Lithos Client</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://localhost:9000/assets/docs/tutorial-basics/lfsm-core"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="LFSM Core | Lithos Client"><meta data-rh="true" name="description" content="The core LFSM contracts concern the maintenance of LFSM rollups. Rollups are generated every time a miner on Lithos finds a new block."><meta data-rh="true" property="og:description" content="The core LFSM contracts concern the maintenance of LFSM rollups. Rollups are generated every time a miner on Lithos finds a new block."><link data-rh="true" rel="icon" href="/assets/img/favicon.ico"><link data-rh="true" rel="canonical" href="http://localhost:9000/assets/docs/tutorial-basics/lfsm-core"><link data-rh="true" rel="alternate" href="http://localhost:9000/assets/docs/tutorial-basics/lfsm-core" hreflang="en"><link data-rh="true" rel="alternate" href="http://localhost:9000/assets/docs/tutorial-basics/lfsm-core" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/assets/blog/rss.xml" title="Lithos Client RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/assets/blog/atom.xml" title="Lithos Client Atom Feed"><link rel="stylesheet" href="/assets/assets/css/styles.c5cdd0f0.css">
<script src="/assets/assets/js/runtime~main.6da10f46.js" defer="defer"></script>
<script src="/assets/assets/js/main.0119fb65.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/assets/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/assets/"><div class="navbar__logo"><img src="/assets/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/assets/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Lithos Client</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/assets/docs/intro">‚ÑπÔ∏è Information</a><a class="navbar__item navbar__link" href="/assets/docs/startup-intro">üèÉ Startup Guide</a><a class="navbar__item navbar__link" href="/assets/docs/category/lithos-api">üñ•Ô∏è Lithos API</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Lithos-Protocol" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/assets/docs/intro">Lithos Protocol</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/assets/docs/tutorial-basics/lithos-info">Lithos Information</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/assets/docs/tutorial-basics/lfsm">LFSM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/assets/docs/tutorial-basics/lfsm-core">LFSM Core</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/assets/docs/tutorial-basics/mining-on-lithos">Mining on Lithos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/assets/docs/tutorial-basics/NISPs">NISPs</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_xLCN"><div class="docItemContainer_jfFK"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/assets/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">LFSM Core</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><div class="row"><div class="col col--12 markdown"><header><h1>LFSM Core</h1></header>
<p>The core LFSM contracts concern the maintenance of LFSM rollups. Rollups are generated <strong>every time a miner on Lithos finds a new block.</strong>
Each LFSM Rollup is considered an <em>optimistic rollup</em>, which has three phases and five transformations. Each rollup state is represented by the AVL Tree in <em>R4</em> of the LFSM contract. This AVL Tree, called the <em>NISP Tree</em>, holds all NISPs submitted by miners to prove that they performed work.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="holding-phase">Holding Phase<a href="#holding-phase" class="hash-link" aria-label="Direct link to Holding Phase" title="Direct link to Holding Phase">‚Äã</a></h2>
<p>The Holding phase is the initial state of an LFSM rollup. When a collateral UTXO is included in a mined block, it is spent to create a new UTXO under the <em>holding contract</em>. This UTXO has an empty AVL Tree in <em>R4</em>, along with zeroed values for the number of miners (<em>R5</em>),
and total score (<em>R6</em>). <em>R7</em> of the <em>holding contract</em> defines the start of the current phase, which is the blockheight of the mined block.</p>
<div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">holding.ergo</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // REGISTERS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // R4: NISP Tree, initially, an empty AVL Tree. AVL Tree of ( hashedPropBytes -&gt; NISP )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // R5: Total Miners (incremented every NISP posted) for this period</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // R6: Total Share Score (added to for every NISP posted, using given ShareScore from first 8 bytes of NISP)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // NOTE: R6 is of type BigInt, but share scores are of type Long. This is NOT a tau representation of score!!!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // It is simply the sum of all (Long) share scores stored in a BigInt value, so as to save blockchain space.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // R7: Period Start (time or height of block mining in which this box was created, ex. during block mining and collateral exchange)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  val nispTree:      AvlTree = SELF.R4[AvlTree].get</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  val currentMiners: Int     = SELF.R5[Int].get</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  val totalScore:    Long    = SELF.R6[BigInt].get</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  val currentPeriod: Long    = SELF.R7[Long].get</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="nisp-submissions">NISP Submissions<a href="#nisp-submissions" class="hash-link" aria-label="Direct link to NISP Submissions" title="Direct link to NISP Submissions">‚Äã</a></h3>
<p>While <code>HEIGHT &lt; currentPeriod + HOLDING_PERIOD</code>, miners may submit NISPs to the holding contract. As the LFSM uses optimistic rollups,
minimal evaluation of NISPs occurs when submitted. <strong>Only the first 8 bytes of the NISP are checked</strong>, these bytes contain the score which is then added to the <code>totalScore</code> register on the holding contract output. Additionally, the digest of the NISP Tree and the value of <code>currentMiners</code> is updated.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="holding-transformation">Holding Transformation<a href="#holding-transformation" class="hash-link" aria-label="Direct link to Holding Transformation" title="Direct link to Holding Transformation">‚Äã</a></h3>
<p>Once <code>HEIGHT &gt;= currentPeriod + HOLDING_PERIOD</code>, NISP submissions to the contract are no longer accepted. At this point, any miner may perform the <em>holding transformation</em>, to transition the phase of this UTXO from <code>HOLDING</code> to <code>EVAL</code>. The transformation takes the holding contract and outputs a new <em>evaluation contract</em>. <strong>All but two registers stay the same during this transformation.</strong> <em>R7</em> is updated to the height of the blockchain at the time of the transformation. Additionally, the value of <code>currentPeriod</code> from the holding contract is copied into <em>R8</em> of the evaluation contract, as this is used in certain fraud proofs.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="evaluation-phase">Evaluation Phase<a href="#evaluation-phase" class="hash-link" aria-label="Direct link to Evaluation Phase" title="Direct link to Evaluation Phase">‚Äã</a></h2>
<p>The <code>EVAL</code> state of an LFSM Rollup deals with the evaluation of all submitted NISPs. After the end of the <code>HOLDING</code> phase, all NISP submissions are closed down. At this point, miners running <strong>Lithos clients will attempt to prove fraudulence for every single miner found in the NISP Tree.</strong> To do this, miners must use one of the authenticated fraud proof contracts found in <em>R4</em> of the <code>FP_CONTROL</code> UTXO.</p>
<div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">evaluation.ergo</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // REGISTERS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // R4: NISP Tree, filled with submissions ( hashedPropBytes -&gt; NISP )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // R5: Total Miners (decremented after FP posted) for this period</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // R6: Total Share Score (subtracted from after valid FP is posted)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // R7: Period Start (time or height of block mining in which this box was created, in this case after holding period.)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // R8: Current Block (Period Start from holding contract)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  val nispTree:      AvlTree = SELF.R4[AvlTree].get</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  val currentMiners: Int     = SELF.R5[Int].get</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  val totalScore:    Long    = SELF.R6[BigInt].get</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  val currentPeriod: Long    = SELF.R7[Long].get</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  val currentBlock:  Long    = SELF.R8[Long].get</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fraud-proof-application">Fraud Proof Application<a href="#fraud-proof-application" class="hash-link" aria-label="Direct link to Fraud Proof Application" title="Direct link to Fraud Proof Application">‚Äã</a></h3>
<p>Application of a fraud proof to an evaluation contract implies the existence of fraud for a certain miner. There are a number of
different fraud proofs which exist on the <code>FP_CONTROL</code> UTXO, each one checks certain aspects of a NISP to verify that a fraudulence occurred. Despite the differences between each fraud proof, all fraud proofs verify the following actions are performed after fraud is proven for a miner:</p>
<ul>
<li>The miner is removed from the NISP Tree</li>
<li>The miner&#x27;s score is subtracted from <code>totalScore</code></li>
<li><code>currentMiners</code> is decremented by one</li>
</ul>
<p>These actions ensure that a fraudulent miner&#x27;s rewards are slashed, and that payout calculations remain correct in the next phase.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="evaluation-transformation">Evaluation Transformation<a href="#evaluation-transformation" class="hash-link" aria-label="Direct link to Evaluation Transformation" title="Direct link to Evaluation Transformation">‚Äã</a></h3>
<p>Similar to the holding contract, fraud proof evaluation only occurs while <code>HEIGHT &lt; currentPeriod + EVAL_PERIOD</code>. Once
<code>HEIGHT &gt;= currentPeriod + EVAL_PERIOD</code>, the evaluation contract is ready to be transitioned to the <code>PAYOUT</code> state.
This transformation is quite simple, in that <strong>almost all registers are conserved.</strong> The only difference is that <em>R7</em> goes from
being <code>currentPeriod</code> to <code>blockReward</code> on the <em>payout contract</em>, with its value initialized to the total amount of ERG held in the evaluation contract. <em>R8</em> is not checked in the payout contract.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="payout-phase">Payout Phase<a href="#payout-phase" class="hash-link" aria-label="Direct link to Payout Phase" title="Direct link to Payout Phase">‚Äã</a></h2>
<p>Once evaluation has completed, it is assumed that all remaining miners on the NISP Tree are truthful miners. At this point, it is time for miners to receive ERG for mining on the Lithos pool. Miners receive ERG according to the amount of work they performed. Work is measured using the <code>score</code> found in the first 8 bytes of miner&#x27;s submitted NISP.</p>
<div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">payout.ergo</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // REGISTERS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // R4: NISP Tree, filled with miners which passed evaluation period ( hashedPropBytes -&gt; NISP )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // R5: Total Miners, constant on spend</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // R6: Total Share Score constant on spend</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // R7: Total block reward, equal to initial block value when transforming from EvalContract</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  val nispTree:      AvlTree = SELF.R4[AvlTree].get</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  val currentMiners: Int     = SELF.R5[Int].get</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  val totalScore:    BigInt  = SELF.R6[BigInt].get</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  val totalReward:   Long    = SELF.R7[Long].get</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="payout-application">Payout Application<a href="#payout-application" class="hash-link" aria-label="Direct link to Payout Application" title="Direct link to Payout Application">‚Äã</a></h3>
<p>Any miner may apply a transaction which performs payouts for any number of miners remaining in the NISP Tree. Once a payout is performed, the miner is removed from the NISP Tree so that duplicate payments do not occur. Payment is calculated in the following manner:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> ((totalReward.toBigInt * minerScore.toBigInt) / totalScore).toLong</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If less than <code>0.001 ERG</code> remains in the payout contract, a miner may fully spend the payout utxo without creating a corresponding output for it.</p></div></div></div><div class="row"><div class="col col--12"><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/assets/docs/tags/lfsm">lfsm</a></li></ul></div></div></footer></div></div></article><div class="row"><div class="col col--12"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/assets/docs/tutorial-basics/lfsm"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">LFSM</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/assets/docs/tutorial-basics/mining-on-lithos"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Mining on Lithos</div></a></nav></div></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#holding-phase" class="table-of-contents__link toc-highlight">Holding Phase</a><ul><li><a href="#nisp-submissions" class="table-of-contents__link toc-highlight">NISP Submissions</a></li><li><a href="#holding-transformation" class="table-of-contents__link toc-highlight">Holding Transformation</a></li></ul></li><li><a href="#evaluation-phase" class="table-of-contents__link toc-highlight">Evaluation Phase</a><ul><li><a href="#fraud-proof-application" class="table-of-contents__link toc-highlight">Fraud Proof Application</a></li><li><a href="#evaluation-transformation" class="table-of-contents__link toc-highlight">Evaluation Transformation</a></li></ul></li><li><a href="#payout-phase" class="table-of-contents__link toc-highlight">Payout Phase</a><ul><li><a href="#payout-application" class="table-of-contents__link toc-highlight">Payout Application</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/assets/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://t.me/LITHOS_Protocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/LithosProtocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/Lithos-Protocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>